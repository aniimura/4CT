<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>第3章: ケンペ鎖と交換 — 四色定理の証明</title>
<link rel="stylesheet" href="style.css">
<script>
MathJax = {
  tex: { inlineMath: [['$','$']], displayMath: [['$$','$$']],
         macros: { conn: '\\mathrm{conn}', QED: '\\blacksquare' } },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
</head>
<body>

<div class="nav-header">
  <a href="02_coloring.html">&larr; 前へ</a>
  <a href="index.html">目次</a>
  <a href="04_setup.html">次へ &rarr;</a>
</div>

<p class="chapter-number">第3章</p>
<h1>ケンペ鎖と交換</h1>

<div class="learning-box">
<h3>このページで学ぶこと</h3>
<ul>
<li>ケンペ部分グラフ $H_{a,b}$ の定義</li>
<li>ケンペ鎖（連結成分）</li>
<li>ケンペ交換の操作</li>
<li>交換が正則彩色を保存すること</li>
<li>成分数 $p_{a,b}$ とサイクルランク $L_{a,b}$</li>
</ul>
</div>

<div class="prereq-box">
<strong>前提:</strong> 第1章（グラフ）、第2章（正則彩色）
</div>

<!-- ===== 3.1 ケンペ部分グラフ ===== -->
<h2>ケンペ部分グラフ</h2>

<div class="thm-box definition">
<strong>定義1（ケンペ部分グラフ）.</strong>
グラフ $G$ の正則4彩色 $\varphi$ と2色 $\{a, b\} \subset \{0,1,2,3\}$ が与えられたとき、
$\{a,b\}$-<strong>ケンペ部分グラフ</strong> $H_{a,b}$ は次のように定義される：
<ul style="font-style:normal;">
<li><strong>頂点集合：</strong> 色 $a$ または $b$ を持つ頂点全体</li>
<li><strong>辺集合：</strong> 元のグラフ $G$ の辺のうち、一方の端点が色 $a$、他方が色 $b$ であるもの</li>
</ul>
$H_{a,b}$ の連結成分を<strong>ケンペ鎖</strong>（Kempe chain）と呼ぶ。
</div>

<div class="explanation">
<h4>平易な解説</h4>
<p>4色で塗られたグラフから、特定の2色（たとえば赤と青）だけに注目します。
赤い頂点と青い頂点だけを残し、赤と青が隣接している辺だけを残します。
これがケンペ部分グラフ $H_{\text{赤},\text{青}}$ です。</p>
<p>このグラフは一般に複数の「かたまり」（連結成分）に分かれます。
各「かたまり」がケンペ鎖です。</p>
</div>

<div class="example-block">
<h4>具体例：小さなグラフでのケンペ部分グラフ</h4>
<p>以下の6頂点の平面グラフに正則4彩色を与えます：</p>
<div class="figure">
<svg width="320" height="200" viewBox="0 0 320 200">
  <!-- Graph edges -->
  <line x1="60" y1="40" x2="160" y2="40" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="160" y1="40" x2="260" y2="40" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="60" y1="40" x2="60" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="160" y1="40" x2="160" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="260" y1="40" x2="260" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="60" y1="150" x2="160" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="160" y1="150" x2="260" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="60" y1="40" x2="160" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="160" y1="40" x2="260" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <!-- Highlight H_{0,1} edges (red-blue) -->
  <line x1="60" y1="40" x2="160" y2="40" stroke="#805ad5" stroke-width="3"/>
  <line x1="60" y1="150" x2="160" y2="150" stroke="#805ad5" stroke-width="3"/>
  <!-- Vertices: colors 0=red, 1=blue, 2=green, 3=yellow -->
  <circle cx="60" cy="40" r="14" fill="#e53e3e" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="160" cy="40" r="14" fill="#3182ce" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="260" cy="40" r="14" fill="#38a169" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="60" cy="150" r="14" fill="#3182ce" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="160" cy="150" r="14" fill="#e53e3e" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="260" cy="150" r="14" fill="#d69e2e" stroke="#2d3748" stroke-width="1.5"/>
  <!-- Color numbers -->
  <text x="60" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">0</text>
  <text x="160" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">1</text>
  <text x="260" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">2</text>
  <text x="60" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">1</text>
  <text x="160" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">0</text>
  <text x="260" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">3</text>
</svg>
<div class="figure-caption">正則4彩色されたグラフ。紫の太線が $H_{0,1}$（赤-青ケンペ部分グラフ）の辺。</div>
</div>
<p>$H_{0,1}$ は色0（赤）と色1（青）の頂点だけを見ます：</p>
<ul>
<li>頂点：左上(0)、中上(1)、左下(1)、中下(0) の4つ</li>
<li>辺：左上(0)—中上(1) と 左下(1)—中下(0) の2本（紫の太線）</li>
<li>連結成分は <strong>2つ</strong>：{左上, 中上} と {左下, 中下}</li>
</ul>
<p>よって $p_{0,1} = 2$（2つのケンペ鎖）。</p>
</div>

<!-- ===== 3.2 ケンペ交換 ===== -->
<h2>ケンペ交換</h2>

<div class="thm-box definition">
<strong>定義（ケンペ交換）.</strong>
$H_{a,b}$ の1つの連結成分（ケンペ鎖）$C$ 上で色 $a$ と $b$ を入れ替える操作を
<strong>ケンペ交換</strong>（Kempe swap）と呼ぶ。すなわち：
$$\varphi'(v) = \begin{cases}
b & \text{$v \in C$ かつ $\varphi(v) = a$ のとき} \\
a & \text{$v \in C$ かつ $\varphi(v) = b$ のとき} \\
\varphi(v) & \text{$v \notin C$ のとき}
\end{cases}$$
</div>

<div class="thm-box">
<strong>命題（ケンペ交換は正則彩色を保存する）.</strong>
$\varphi$ が正則彩色ならば、$\varphi'$ も正則彩色である。
</div>

<div class="proof-block">
<span class="proof-title">証明.</span>
矛盾を導く。$\varphi'$ が正則でないとすると、ある辺 $\{u,w\}$ で
$\varphi'(u) = \varphi'(w)$ となる。$\varphi$ は正則だったので
$\varphi(u) \neq \varphi(w)$ であり、少なくとも一方は交換で色が変わった。
<ul>
<li>$u \in C$, $w \notin C$ の場合：$\varphi(u) \in \{a,b\}$ で $\varphi'(u)$ は $a$ か $b$。
  $w$ の色は変わらないので $\varphi'(w) = \varphi(w) \in \{a,b\}$。
  しかし $\{u,w\}$ は辺であり $\varphi(u), \varphi(w) \in \{a,b\}$ で異なるなら
  $w$ は $H_{a,b}$ の頂点で $u$ と隣接 &mdash; つまり $w$ も $C$ に含まれるはずで矛盾。</li>
<li>$u, w \in C$ の場合：$C$ 内のすべての辺で $a$ と $b$ が同時に入れ替わるので、
  元々異なっていた色関係は保存される。</li>
</ul>
<span class="proof-end">$\QED$</span>
</div>

<div class="explanation">
<h4>直感的な理解</h4>
<p>ケンペ交換は「2色を入れ替える」操作ですが、入れ替えるのは1つの連結成分だけです。
なぜ正則彩色が壊れないかというと：</p>
<ul>
<li>成分の<strong>内部</strong>では、赤↔青がすべて同時に交換されるので、赤-青の辺は赤-青のまま。</li>
<li>成分の<strong>境界</strong>では、成分内の頂点（赤か青）と成分外の頂点が隣接するが、
成分外の頂点は緑か黄色（赤でも青でもない）。交換後も赤→青、青→赤 なので、
緑や黄色とは異なったまま。</li>
</ul>
</div>

<div class="example-block">
<h4>具体例：ケンペ交換の実行</h4>
<p>上の例で、$H_{0,1}$ の第1成分 {左上, 中上} 上で交換します：</p>
<div class="figure">
<svg width="600" height="200" viewBox="0 0 600 200">
  <!-- Before -->
  <text x="130" y="15" text-anchor="middle" font-size="14" fill="#4a5568" font-weight="bold">交換前</text>
  <!-- edges -->
  <line x1="40" y1="40" x2="130" y2="40" stroke="#805ad5" stroke-width="3"/>
  <line x1="130" y1="40" x2="220" y2="40" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="40" y1="40" x2="40" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="130" y1="40" x2="130" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="220" y1="40" x2="220" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="40" y1="150" x2="130" y2="150" stroke="#805ad5" stroke-width="3"/>
  <line x1="130" y1="150" x2="220" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="40" y1="40" x2="130" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="130" y1="40" x2="220" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <!-- vertices -->
  <circle cx="40" cy="40" r="14" fill="#e53e3e" stroke="#805ad5" stroke-width="3"/>
  <circle cx="130" cy="40" r="14" fill="#3182ce" stroke="#805ad5" stroke-width="3"/>
  <circle cx="220" cy="40" r="14" fill="#38a169" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="40" cy="150" r="14" fill="#3182ce" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="130" cy="150" r="14" fill="#e53e3e" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="220" cy="150" r="14" fill="#d69e2e" stroke="#2d3748" stroke-width="1.5"/>
  <text x="40" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">0</text>
  <text x="130" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">1</text>
  <text x="220" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">2</text>
  <text x="40" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">1</text>
  <text x="130" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">0</text>
  <text x="220" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">3</text>

  <!-- Arrow -->
  <text x="290" y="100" text-anchor="middle" font-size="28" fill="#805ad5">&rArr;</text>
  <text x="290" y="120" text-anchor="middle" font-size="11" fill="#805ad5">交換</text>

  <!-- After -->
  <text x="470" y="15" text-anchor="middle" font-size="14" fill="#4a5568" font-weight="bold">交換後</text>
  <line x1="380" y1="40" x2="470" y2="40" stroke="#805ad5" stroke-width="3"/>
  <line x1="470" y1="40" x2="560" y2="40" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="380" y1="40" x2="380" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="470" y1="40" x2="470" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="560" y1="40" x2="560" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="380" y1="150" x2="470" y2="150" stroke="#805ad5" stroke-width="3"/>
  <line x1="470" y1="150" x2="560" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="380" y1="40" x2="470" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <line x1="470" y1="40" x2="560" y2="150" stroke="#cbd5e0" stroke-width="1.5"/>
  <!-- swapped vertices (component 1 only) -->
  <circle cx="380" cy="40" r="14" fill="#3182ce" stroke="#805ad5" stroke-width="3"/>
  <circle cx="470" cy="40" r="14" fill="#e53e3e" stroke="#805ad5" stroke-width="3"/>
  <circle cx="560" cy="40" r="14" fill="#38a169" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="380" cy="150" r="14" fill="#3182ce" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="470" cy="150" r="14" fill="#e53e3e" stroke="#2d3748" stroke-width="1.5"/>
  <circle cx="560" cy="150" r="14" fill="#d69e2e" stroke="#2d3748" stroke-width="1.5"/>
  <text x="380" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">1</text>
  <text x="470" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">0</text>
  <text x="560" y="45" text-anchor="middle" font-size="13" fill="white" font-weight="bold">2</text>
  <text x="380" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">1</text>
  <text x="470" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">0</text>
  <text x="560" y="155" text-anchor="middle" font-size="13" fill="white" font-weight="bold">3</text>
</svg>
<div class="figure-caption">左上と中上の成分（紫枠）で色 0↔1 を交換。正則彩色は保たれる。</div>
</div>
<p>交換後、左上は 0→1、中上は 1→0 に変わりました。左下と中下のもう一つの成分は変化しません。
結果は依然として正則4彩色です。</p>
</div>

<!-- ===== 3.3 相補対 ===== -->
<h2>相補対</h2>

<div class="thm-box definition">
<strong>定義（相補対）.</strong>
4色 $\{0,1,2,3\}$ の2色の組 $\{a,b\}$ と $\{c,d\}$ が
$\{a,b,c,d\} = \{0,1,2,3\}$ を満たすとき、
$\{a,b\}$ と $\{c,d\}$ を<strong>相補対</strong>（complementary pair）と呼ぶ。
</div>

<div class="explanation">
<h4>相補対は3つだけ</h4>
<p>4色から2色を選ぶ方法は $\binom{4}{2} = 6$ 通りですが、
これらは3つの相補対に分かれます：</p>
<table>
<tr><th>対1</th><th>対2</th><th>対3</th></tr>
<tr><td>$\{0,1\}$ と $\{2,3\}$</td>
    <td>$\{0,2\}$ と $\{1,3\}$</td>
    <td>$\{0,3\}$ と $\{1,2\}$</td></tr>
</table>
<p>相補対は証明で重要な役割を果たします。
$H_{a,b}$ と $H_{c,d}$ は同じ頂点を共有しません（色が重ならない）が、
辺の構造が深く関連しています。</p>
</div>

<!-- ===== 3.4 成分数とサイクルランク ===== -->
<h2>成分数とサイクルランク</h2>

<div class="thm-box definition">
<strong>定義.</strong>
ケンペ部分グラフ $H_{a,b}$ について：
<ul style="font-style:normal;">
<li>$p_{a,b}$：$H_{a,b}$ の連結成分の数</li>
<li>$n_a$：色 $a$ の頂点数、$n_b$：色 $b$ の頂点数</li>
<li>$E_{a,b}$：$H_{a,b}$ の辺数</li>
<li>$L_{a,b} = E_{a,b} - (n_a + n_b) + p_{a,b}$：<strong>サイクルランク</strong>（cycle rank）</li>
</ul>
</div>

<div class="explanation">
<h4>サイクルランクの意味</h4>
<p>サイクルランクは「グラフがどのくらい閉路を含むか」を測る量です：</p>
<ul>
<li>$L_{a,b} = 0$ ⇔ $H_{a,b}$ のすべての連結成分が<strong>木</strong>（tree、閉路のない連結グラフ）</li>
<li>$L_{a,b} = 1$ ⇔ ちょうど1つの成分に1つの閉路がある</li>
<li>一般に $L_{a,b} \geq 0$</li>
</ul>
<p>木の性質：$V$ 個の頂点を持つ木は $V - 1$ 本の辺を持つ。
$p$ 個の成分がすべて木なら $E = V - p$ であり、
$L = E - V + p = 0$ です。</p>
</div>

<div class="example-block">
<h4>具体例：サイクルランクの計算</h4>
<p>先の例で $H_{0,1}$ を計算します：</p>
<ul>
<li>$n_0 = 2$（赤の頂点数）、$n_1 = 2$（青の頂点数）</li>
<li>$E_{0,1} = 2$（赤-青の辺数）</li>
<li>$p_{0,1} = 2$（連結成分数）</li>
<li>$L_{0,1} = 2 - (2 + 2) + 2 = 0$</li>
</ul>
<p>$L = 0$ なので、$H_{0,1}$ の各成分は木（実際、各成分は辺1本の「パス」）。</p>
</div>

<div class="takeaway">
<h3>ポイント</h3>
<ul>
<li>ケンペ部分グラフ $H_{a,b}$：色 $a, b$ の頂点と $a$-$b$ 辺だけを取り出したグラフ。</li>
<li>ケンペ鎖：$H_{a,b}$ の連結成分。鎖上で色を交換しても正則彩色は保たれる。</li>
<li>相補対：$\{a,b\}$ と $\{c,d\}$ で4色すべてをカバー。3つの相補対がある。</li>
<li>成分数 $p_{a,b}$ とサイクルランク $L_{a,b}$ がケンペ部分グラフの構造を特徴づける。</li>
<li>$L_{a,b} = 0$ は「すべての成分が木」を意味する。</li>
</ul>
</div>

<div class="nav-footer">
  <a href="02_coloring.html">&larr; 前へ: グラフ彩色</a>
  <a href="index.html">目次</a>
  <a href="04_setup.html">次へ: 次数5の設定 &rarr;</a>
</div>

</body>
</html>
